float data[800]={-0.061998155,-0.111750819,-0.150085204,-0.174802516,-0.194939458,-0.206782147,-0.21022402,-0.212239534,-0.199584152,-0.186277274,-0.166790534,-0.147741362,-0.125589024,-0.105548321,-0.088384327,-0.07872468,-0.066077863,-0.053916298,-0.057373953,-0.064838436,-0.067253814,-0.072182392,-0.083109736,-0.099059326,-0.10841759,-0.129569745,-0.141617272,-0.15793026,-0.176179262,-0.193457601,-0.203358054,-0.218700423,-0.236059828,-0.247743896,-0.259821835,-0.230944075,-0.145475446,-0.007368048,0.140208043,0.321863373,0.502781086,0.650335724,0.766595141,0.895356723,1,0.983549241,0.900192844,0.785719462,0.668745605,0.537771599,0.418302484,0.312038972,0.222010856,0.13868573,0.060355389,-0.009853487,-0.067389156,-0.122498619,-0.164751301,-0.199031404,-0.236956754,-0.253525717,-0.276132072,-0.282408966,-0.28962699,-0.28373288,-0.276591244,-0.259547275,-0.234043948,-0.210213632,-0.191036802,-0.184270078,-0.165505286,-0.157360091,-0.154684926,-0.146320036,-0.149948819,-0.152526455,-0.155688539,-0.171412733,-0.181545431,-0.186425663,-0.203086257,-0.212355847,-0.222955033,-0.229313438,-0.256454236,-0.26241496,-0.289554635,-0.307404189,-0.323775179,-0.336311771,-0.316076083,-0.232327967,-0.106233413,0.044607986,0.217666475,0.404429923,0.557259514,0.69375682,0.83174943,0.931641269,0.922028231,0.848251537,0.73515433,0.614370539,0.48996309,0.380608622,0.273394555,0.17987136,0.103058671,0.025063206,-0.042349661,-0.101414037,-0.158901177,-0.196470564,-0.231080099,-0.258279241,-0.286614751,-0.297161141,-0.307796553,-0.306572934,-0.296840982,-0.280660227,-0.262714959,-0.244571803,-0.216258191,-0.196095457,-0.183523289,-0.16131279,-0.150972502,-0.141288953,-0.134603251,-0.13151834,-0.131476007,-0.14202098,-0.147005706,-0.15702544,-0.167274498,-0.181858734,-0.204995391,-0.2148479,-0.236441125,-0.249620254,-0.264661028,-0.275979664,-0.285528616,-0.303560874,-0.296667802,-0.236834806,-0.120416619,0.026633056,0.187717184,0.353752252,0.510200793,0.659708863,0.796710753,0.90446376,0.924171722,0.85519011,0.748137952,0.633800152,0.510158024,0.395959454,0.285583128,0.187935858,0.108210938,0.033339924,-0.04022176,-0.096747873,-0.152482504,-0.198901082,-0.232774569,-0.269572949,-0.294001731,-0.301064797,-0.306819067,-0.29990098,-0.294899721,-0.284140269,-0.267293347,-0.258577574,-0.239232357,-0.224686937,-0.205013137,-0.186683047,-0.174623019,-0.171729743,-0.161494181,-0.158272898,-0.165783393,-0.161553412,-0.174158674,-0.178380386,-0.191642537,-0.202040892,-0.213210556,-0.221423604,-0.230933876,-0.234100933,-0.252933529,-0.261153113,-0.271023468,-0.278169325,-0.269087659,-0.21952833,-0.120514351,-0.004181148,0.126164462,0.262973804,0.392481652,0.518405222,0.642113674,0.741398594,0.776768705,0.751500059,0.690108429,0.608907956,0.509112379,0.414889346,0.327823656,0.243395229,0.167000727,0.087286094,0.012367248,-0.04366366,-0.085222781,-0.117399933,-0.152834135,-0.177432224,-0.19184555,-0.194206902,-0.197805823,-0.198314197,-0.192775421,-0.179041914,-0.176000832,-0.163918071,-0.144698731,-0.143607988,-0.140563695,-0.139309024,-0.137059992,-0.142593325,-0.147425753,-0.1532914,-0.163440626,-0.177879008,-0.19009081,-0.197407159,-0.213223638,-0.22036747,-0.229538555,-0.245628977,-0.25880085,-0.269282531,-0.287365087,-0.300160703,-0.310946424,-0.289930574,-0.231941564,-0.1512873,-0.054728251,0.058603454,0.183774269,0.322786609,0.462368964,0.588046122,0.671127475,0.70267823,0.694754215,0.656869852,0.599731241,0.527064917,0.449452677,0.379002194,0.310531282,0.238147248,0.170144193,0.105828319,0.045756452,-0.01156355,-0.059979797,-0.097490309,-0.131827541,-0.158470828,-0.174594261,-0.184204726,-0.185857662,-0.183493952,-0.177641877,-0.166094406,-0.158423086,-0.148432156,-0.142998074,-0.143141101,-0.146672554,-0.148291932,-0.151037592,-0.155365247,-0.166714244,-0.174275703,-0.179236078,-0.190795373,-0.196043135,-0.217258565,-0.231534943,-0.245504768,-0.256257565,-0.278192153,-0.289199007,-0.301946665,-0.314855707,-0.316496029,-0.284448927,-0.198102312,-0.093080205,0.032723376,0.179276843,0.34446192,0.510777617,0.648198021,0.732315988,0.759881028,0.742846747,0.691633387,0.627205877,0.543369716,0.458550335,0.37339016,0.30042595,0.227827461,0.167194299,0.104889251,0.046856671,-0.012384424,-0.05820609,-0.0968136,-0.128986887,-0.157018326,-0.176206335,-0.190515811,-0.201388667,-0.207981259,-0.20083397,-0.198680458,-0.197246376,-0.195236604,-0.190053011,-0.18602143,-0.190796087,-0.18551329,-0.182346115,-0.19033882,-0.204766486,-0.215039824,-0.231377829,-0.245903994,-0.274612569,-0.294734205,-0.312099203,-0.328287718,-0.338769099,-0.348253318,-0.358123376,-0.373346774,-0.380954819,-0.395466074,-0.394698639,-0.37781989,-0.322936071,-0.223961082,-0.109487168,0.011285795,0.155950942,0.307432488,0.463526155,0.580678711,0.641709915,0.662516804,0.637602966,0.603867814,0.546318685,0.480101451,0.421876474,0.354247993,0.295111862,0.230973294,0.174540212,0.11608972,0.071221098,0.036789476,0.004312407,-0.02269478,-0.039847416,-0.049867168,-0.058749962,-0.060828812,-0.061301242,-0.047914065,-0.032896507,-0.017048733,-0.010662801,-0.01471776,-0.015433976,-0.01712477,-0.028455547,-0.043173864,-0.042068711,-0.047313685,-0.058322721,-0.075841584,-0.097299918,-0.130487128,-0.148711187,-0.167876637,-0.199477392,-0.219120909,-0.239415927,-0.249561422,-0.261113283,-0.263596019,-0.274488449,-0.284130849,-0.281649108,-0.249256585,-0.198862985,-0.131668237,-0.058749933,0.025928739,0.122395117,0.206713031,0.273522619,0.320402587,0.340702546,0.342454295,0.330684445,0.307200971,0.279086766,0.241307756,0.200959166,0.158166089,0.118648679,0.070737185,0.016524331,-0.027847603,-0.079466768,-0.128636462,-0.164801978,-0.193249935,-0.196082782,-0.18460581,-0.15999461,-0.132695469,-0.098726594,-0.061877655,-0.032414886,-0.01292529,0.002634881,0.000428914,-0.011044997,-0.019625255,-0.031055999,-0.036948308,-0.044612827,-0.053694113,-0.067305955,-0.065006128,-0.064017834,-0.065431267,-0.072479752,-0.078897095,-0.089708329,-0.100129881,-0.110748131,-0.123215238,-0.146835454,-0.173317394,-0.197942462,-0.219143071,-0.221584033,-0.177020093,-0.072802955,0.076375896,0.263549119,0.456708718,0.630647216,0.754470493,0.825461178,0.832359892,0.794778497,0.71564224,0.620518601,0.509800987,0.412381328,0.322043116,0.228358995,0.143939931,0.062449049,-0.017609254,-0.087574935,-0.154397459,-0.206871965,-0.230228473,-0.266872394,-0.28490096,-0.312209474,-0.331026293,-0.337128222,-0.335031465,-0.313041134,-0.287151038,-0.240325753,-0.21568254,-0.179571618,-0.154426014,-0.150692052,-0.153022807,-0.160544552,-0.179472087,-0.196624414,-0.204566331,-0.227925299,-0.249567728,-0.272620675,-0.291409828,-0.304228337,-0.315374083,-0.318864924,-0.314865272,-0.308140192,-0.299545244,-0.307284198,-0.3080246,-0.314889125,-0.317653009,-0.295121621,-0.242850693,-0.124185613,0.048941649,0.267777768,0.49993943,0.707839531,0.859556702,0.929191352,0.926122146,0.859263178,0.752963824,0.626361302,0.497218893,0.379866874,0.267335823,0.167473041,0.074416351,-0.000183223,-0.072318966,-0.133467095,-0.187605238,-0.229723487,-0.260517161,-0.275695055,-0.288460753,-0.287337955,-0.278068824,-0.263068692,-0.247846639,-0.221022212,-0.182776931,-0.137702885,-0.100218057,-0.065385215,-0.042241669,-0.022261894,-0.011527129,-0.019744973,-0.029184308,-0.040410583,-0.064224524,-0.087444429,-0.100966427,-0.110354249,-0.117822755,-0.115033147,-0.119697288,-0.11996912,-0.113979174,-0.127621712,-0.158231501,-0.174830562,-0.212454178,-0.24168968,-0.250685441,-0.275881688,-0.275486654,-0.209785853,-0.114430883,-0.008929089,0.118327276,0.251574144,0.360340519,0.442285567,0.506304111,0.537571203,0.496492847,0.436439459,0.39240699,0.450063588,0.455798397,0.309533779,0.235964877,0.204299972,0.120454016,0.064381976,0.032673679,-0.021375262,-0.068612332,-0.086423494,-0.102246222,-0.115320078,-0.124002401,-0.127367654,-0.12199947,-0.110854774,-0.099817813,-0.087629623,-0.073782882,-0.05877201,-0.046073763,-0.041608206,-0.048309331,-0.053093519,-0.047139958,-0.061062928,-0.070063377,-0.069322275,-0.086415634,-0.094652949,-0.107220563,-0.126533473,-0.136107043,-0.145985054,-0.163873228,-0.160323717,-0.169703162,-0.173639808,-0.183663981,-0.193558802,-0.203509303,-0.20846309,-0.211509629,-0.176995326,-0.091818712,0.029414083,0.165865703,0.31998391,0.46308173,0.570117872,0.633852237,0.661820984,0.652052172,0.612191682,0.546747639,0.455091018,0.367520057,0.278233801,0.178438098,0.085579462,0.013833781,-0.061327642,-0.131448375,-0.180031571,-0.223426199,-0.256808778,-0.269034143,-0.275236738,-0.279418598,-0.27163942,-0.25220942,-0.231385293,-0.191770716,-0.155023453,-0.127287992,-0.10111009,-0.078115538,-0.068723631,-0.060657289,-0.064479383,-0.069223597,-0.076883839,-0.09026383,-0.099764093,-0.117475012,-0.128428999,-0.141837771,-0.158118809,-0.169898416,-0.178043088,-0.193874506,-0.211229749,-0.228743334,-0.238460908,-0.261225954,-0.280465244,-0.295780758,-0.302183048,-0.29621352,-0.245666806,-0.142351873,0.011849615,0.174085458,0.346722198,0.48674759,0.590469405,0.648488415,0.660280881,0.624634814,0.557040827,0.464834535,0.351299742,0.244974767,0.137641426,0.043690048,-0.045837926,-0.11128674,-0.16895814,-0.222820996,-0.258690196,-0.281657955,-0.294672493,-0.294682366,-0.277835312,-0.258271832,-0.235363199,-0.200037173,-0.17029984,-0.136239718,-0.10360169,-0.066464249,-0.028887597,0.004230916,0.032698161,0.046879616,0.05316363,0.04822528,0.041273127,0.028785477,0.005370328,-0.004061693,-0.024559709,-0.041289109,-0.061801074,-0.082065914,-0.099503585,-0.119785742,-0.130908758,-0.147069627,-0.169628489,-0.190912165,-0.200816335,-0.211216466,-0.210772054,-0.162973101,-0.060402545,0.080003982,0.251578548,0.441974114,0.607586276,0.729977042,0.803710943,0.827316273,0.792532848,0.711800497,0.598579419,0.479519671,0.352635521,0.227688332,0.104783243,0.001740469,-0.086358673,-0.168525118,-0.233855744,-0.285122886,-0.326126913,-0.345901257,-0.354764251,-0.350567194,-0.336665683,-0.308230882,-0.277346672,-0.227424515,-0.181419444,-0.138799938,-0.100471124,-0.066269383,-0.035977892,-0.034918847,-0.029692268,-0.057990125,-0.061518919,-0.119891666};
float filtered[800]={0};
float baseadd[800]={0};
int len=800;
float pi=3.141593523;

void normalize(float* sig,int len){
  float maxm=-100000;
  for(int i=0;i<len;i++)
  {
    if(maxm<sig[i])
    maxm=sig[i];
    }
    maxm=abs(maxm);
    for(int i=0;i<len;i++)
    {
      sig[i]=sig[i]/maxm;
      }
  }
  
void setup() {
  Serial.begin(9600);
  // put your setup code here, to run once:
  float mag=1;float f1=0.1;float f2=0.2;float f3=0.25;float fs=80;
  for(int i=0;i<len;i++)
  {
    baseadd[i]=data[i]+mag*(cos((2*pi*f1*i)/fs)+cos((2*pi*f2*i)/fs)+cos((2*pi*f3*i)/fs));
    }
  filtered[0]=0;filtered[1]=0;
  float g=0.98429;float r=0.96858;
  for(int i=2;i<len;i++)
  {
    //High pass
    //filtered[i]=g*(baseadd[i]-baseadd[i-1])-r*filtered[i-1];
    //Band pass till 5Hz
    //filtered[i]=(baseadd[i]-baseadd[i-2]+3.1519*filtered[i-1]-2.4798*filtered[i-2])/2.7933;
    //Band pass till 10Hz
    //filtered[i]=(baseadd[i]-baseadd[i-2]+2.6728*filtered[i-1]-1.7544*filtered[i-2])/2.7933;
    filtered[i]=(1*(baseadd[i]-baseadd[i-2])+1.0728*filtered[i-1]+1.364*filtered[i-2])/2.7933;
    }
    float mse=0,rmse=0,snr=0,x=0;
    for(int i=0;i<len;i++)
    {
      mse=mse+((filtered[i]-data[i])*(filtered[i]-data[i]));
      x=x+(data[i]*data[i]);
      }
      snr=10*log10(x/mse);
      rmse=sqrt(mse/len);
      mse=mse/len;
     /*Serial.print("MSE: ");Serial.print(mse);Serial.println();
      Serial.print("RMSE: ");Serial.print(rmse);Serial.println();
      Serial.print("SNR: ");Serial.print(snr);Serial.print(" dB");Serial.println();*/
      normalize(baseadd,len);
    normalize(filtered,len);
    normalize(data,len);
}

void loop() {
  // put your main code here, to run repeatedly:
  for(int i=0;i<len;i++)
  {
    Serial.print(data[i]);
    Serial.print(',');
    Serial.print(baseadd[i]+10);
    Serial.print(',');
    Serial.println(filtered[i]+20);
    }
}
